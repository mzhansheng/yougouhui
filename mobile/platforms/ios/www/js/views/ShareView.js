define(["jquery","backbone","views/BackModelView","utils"],function(d,g,e,c){var a=null;var b=null;var f=e.extend({constructor:function(h){f.__super__.constructor.call(this,h)},initialize:function(){f.__super__.initialize.call(this);a=this},render:function(){f.__super__.render.call(this);var k="main-head-share-save-link";var i=d("#"+k);if(i&&i.length>0){i.css("display","block")}else{var h='<a id="'+k+'" class="top-header ui-btn ui-btn-inline ui-corner-all ui-icon-lock ui-btn-icon-left">保存</a>';d("#main-head-search-link").after(h)}c.setDomVisibleExcept(d('[data-role="header"].app-header div a'),[k]);d("#share-choose-pic-img").on("click",function(){c.openPopDiv("#share-choose-pic-pop",d(this))});d("#li-share-camera-pic").on("click",function(){c.closePopDiv("#share-choose-pic-pop");navigator.camera.getPicture(a.onPicChooseSuccess,a.onFail,{quality:20,allowEdit:true,sourceType:Camera.PictureSourceType.CAMERA,destinationType:Camera.DestinationType.FILE_URI})});d("#li-share-choose-pic").on("click",function(){c.closePopDiv("#share-choose-pic-pop");navigator.camera.getPicture(a.onPicChooseSuccess,a.onFail,{quality:20,allowEdit:true,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,destinationType:Camera.DestinationType.FILE_URI})});try{}catch(j){}return this},onPicChooseSuccess:function(m){var h=d("#share-choose-pic-div");var k=m;var l=k.lastIndexOf(".");if(l>0){k=k.substring(0,l)}l=k.lastIndexOf("/");if(l>0){k=k.substring(l+1,k.length)}var i="share-img-"+k;var j='<div class="share-choose-pic" style="max-width:20%"><a href="#" data-rel="popup" id="'+i+'" data-position-to="window" data-transition="fade" class="share-popup-img">  <img src="'+m+'" height="150px" style="margin:5px;max-width:100%"/>  </a> </div>';h.before(j);d("#"+i).on("click",function(){var p=d(this).find("img").attr("src");var o="share-pop-img-id-"+k;if(d("#"+o).length===0){var n=' <div data-role="popup" id="'+o+'" data-overlay-theme="b" data-theme="b" data-corners="false">  <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">关闭</a>  <img src="'+p+'" width="'+d.mobile.activePage.width()+'" height="'+d.mobile.activePage.height()+'"/>  </div>';d.mobile.activePage.append(n).trigger("create")}c.openPopDiv("#"+o,d(this))})},onFail:function(h){alert("获取照片失败，原因："+h)},onGeolocationSuccess:function(h){b=h},ongeolocationError:function(h){alert("获取地理位置出错，原因："+h.message)}});return f});