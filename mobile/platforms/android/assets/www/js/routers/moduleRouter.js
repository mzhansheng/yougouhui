define(["jquery","backbone","collections/ModuleCollection","views/ModuleView","config","utils"],function(m,j,h,l,i,n){var k=j.Router.extend({initialize:function(){this.discoverView=new l({el:"#discover",collection:new h([],{type:"discover"})});j.history.start();this.meView=new l({el:"#me",collection:new h([],{type:"me"})})},routes:{"module?:type":"module"},module:function(b){var a=this[b+"View"];m("#main-back-link").css("display","none");m("#main-head-title").html(i.getAppTitle());n.setDomVisibleExcept(m('[data-role="header"].app-header div a'),["main-head-city-link","main-head-search-link"]);if(a&&!a.collection.length){m.mobile.loading("show");a.collection.fetch({success:function(c,e,d){c.trigger("added")},error:function(){m.mobile.loading("hide");alert("加载数据失败.")}}).done(function(){m.mobile.loading("hide");m.mobile.changePage("#"+b,{reverse:false,changeHash:false})})}else{m.mobile.changePage("#"+b,{reverse:false,changeHash:false})}}});return k});