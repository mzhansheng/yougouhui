(function(){var M=this;var P=M.Backbone;var O=Array.prototype.slice;var D=Array.prototype.splice;var ab;if(typeof exports!=="undefined"){ab=exports}else{ab=M.Backbone={}}ab.VERSION="0.9.2";var N=M._;if(!N&&(typeof require!=="undefined")){N=require("underscore")}var X=M.jQuery||M.Zepto||M.ender;ab.setDomLibrary=function(a){X=a};ab.noConflict=function(){M.Backbone=P;return this};ab.emulateHTTP=false;ab.emulateJSON=false;var ad=/\s+/;var Q=ab.Events={on:function(e,a,f){var g,c,d,h,b;if(!a){return this}e=e.split(ad);g=this._callbacks||(this._callbacks={});while(c=e.shift()){b=g[c];d=b?b.tail:{};d.next=h={};d.context=f;d.callback=a;g[c]={tail:h,next:b?b.next:d}}return this},off:function(d,f,a){var b,c,i,g,h,e;if(!(c=this._callbacks)){return}if(!(d||f||a)){delete this._callbacks;return this}d=d?d.split(ad):N.keys(c);while(b=d.shift()){i=c[b];delete c[b];if(!i||!(f||a)){continue}g=i.tail;while((i=i.next)!==g){h=i.callback;e=i.context;if((f&&h!==f)||(a&&e!==a)){this.on(b,h,e)}}}return this},trigger:function(e){var a,b,f,g,h,c,d;if(!(f=this._callbacks)){return this}c=f.all;e=e.split(ad);d=O.call(arguments,1);while(a=e.shift()){if(b=f[a]){g=b.tail;while((b=b.next)!==g){b.callback.apply(b.context||this,d)}}if(b=c){g=b.tail;h=[a].concat(d);while((b=b.next)!==g){b.callback.apply(b.context||this,h)}}}return this}};Q.bind=Q.on;Q.unbind=Q.off;var T=ab.Model=function(c,b){var a;c||(c={});if(b&&b.parse){c=this.parse(c)}if(a=aa(this,"defaults")){c=N.extend({},a,c)}if(b&&b.collection){this.collection=b.collection}this.attributes={};this._escapedAttributes={};this.cid=N.uniqueId("c");this.changed={};this._silent={};this._pending={};this.set(c,{silent:true});this.changed={};this._silent={};this._pending={};this._previousAttributes=N.clone(this.attributes);this.initialize.apply(this,arguments)};N.extend(T.prototype,Q,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return N.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(c){var b;if(b=this._escapedAttributes[c]){return b}var a=this.get(c);return this._escapedAttributes[c]=N.escape(a==null?"":""+a)},has:function(a){return this.get(a)!=null},set:function(e,f,c){var d,h,j;if(N.isObject(e)||e==null){d=e;c=f}else{d={};d[e]=f}c||(c={});if(!d){return this}if(d instanceof T){d=d.attributes}if(c.unset){for(h in d){d[h]=void 0}}if(!this._validate(d,c)){return false}if(this.idAttribute in d){this.id=d[this.idAttribute]}var g=c.changes={};var a=this.attributes;var b=this._escapedAttributes;var i=this._previousAttributes||{};for(h in d){j=d[h];if(!N.isEqual(a[h],j)||(c.unset&&N.has(a,h))){delete b[h];(c.silent?this._silent:g)[h]=true}c.unset?delete a[h]:a[h]=j;if(!N.isEqual(i[h],j)||(N.has(a,h)!=N.has(i,h))){this.changed[h]=j;if(!c.silent){this._pending[h]=true}}else{delete this.changed[h];delete this._pending[h]}}if(!c.silent){this.change(c)}return this},unset:function(b,a){(a||(a={})).unset=true;return this.set(b,null,a)},clear:function(a){(a||(a={})).unset=true;return this.set(N.clone(this.attributes),a)},fetch:function(b){b=b?N.clone(b):{};var c=this;var a=b.success;b.success=function(d,f,e){if(!c.set(c.parse(d,e),b)){return false}if(a){a(c,d)}};b.error=ab.wrapError(b.error,c,b);return(this.sync||ab.sync).call(this,"read",this,b)},save:function(g,h,c){var f,i;if(N.isObject(g)||g==null){f=g;c=h}else{f={};f[g]=h}c=c?N.clone(c):{};if(c.wait){if(!this._validate(f,c)){return false}i=N.clone(this.attributes)}var a=N.extend({},c,{silent:true});if(f&&!this.set(f,c.wait?a:c)){return false}var j=this;var e=c.success;c.success=function(k,n,l){var m=j.parse(k,l);if(c.wait){delete c.wait;m=N.extend(f||{},m)}if(!j.set(m,c)){return false}if(e){e(j,k)}else{j.trigger("sync",j,k,c)}};c.error=ab.wrapError(c.error,j,c);var b=this.isNew()?"create":"update";var d=(this.sync||ab.sync).call(this,b,this,c);if(c.wait){this.set(i,a)}return d},destroy:function(d){d=d?N.clone(d):{};var e=this;var a=d.success;var b=function(){e.trigger("destroy",e,e.collection,d)};if(this.isNew()){b();return false}d.success=function(f){if(d.wait){b()}if(a){a(e,f)}else{e.trigger("sync",e,f,d)}};d.error=ab.wrapError(d.error,e,d);var c=(this.sync||ab.sync).call(this,"delete",this,d);if(!d.wait){b()}return c},url:function(){var a=aa(this,"urlRoot")||aa(this.collection,"url")||I();if(this.isNew()){return a}return a+(a.charAt(a.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(c){c||(c={});var a=this._changing;this._changing=true;for(var d in this._silent){this._pending[d]=true}var b=N.extend({},c.changes,this._silent);this._silent={};for(var d in b){this.trigger("change:"+d,this,this.get(d),c)}if(a){return this}while(!N.isEmpty(this._pending)){this._pending={};this.trigger("change",this,c);for(var d in this.changed){if(this._pending[d]||this._silent[d]){continue}delete this.changed[d]}this._previousAttributes=N.clone(this.attributes)}this._changing=false;return this},hasChanged:function(a){if(!arguments.length){return !N.isEmpty(this.changed)}return N.has(this.changed,a)},changedAttributes:function(c){if(!c){return this.hasChanged()?N.clone(this.changed):false}var a,b=false,d=this._previousAttributes;for(var e in c){if(N.isEqual(d[e],(a=c[e]))){continue}(b||(b={}))[e]=a}return b},previous:function(a){if(!arguments.length||!this._previousAttributes){return null}return this._previousAttributes[a]},previousAttributes:function(){return N.clone(this._previousAttributes)},isValid:function(){return !this.validate(this.attributes)},_validate:function(a,b){if(b.silent||!this.validate){return true}a=N.extend({},this.attributes,a);var c=this.validate(a,b);if(!c){return true}if(b&&b.error){b.error(this,c,b)}else{this.trigger("error",this,c,b)}return false}});var L=ab.Collection=function(a,b){b||(b={});if(b.model){this.model=b.model}if(b.comparator){this.comparator=b.comparator}this._reset();this.initialize.apply(this,arguments);if(a){this.reset(a,{silent:true,parse:b.parse})}};N.extend(L.prototype,Q,{model:T,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},add:function(a,c){var g,e,j,f,d,k,i={},b={},h=[];c||(c={});a=N.isArray(a)?a.slice():[a];for(g=0,j=a.length;g<j;g++){if(!(f=a[g]=this._prepareModel(a[g],c))){throw new Error("Can't add an invalid model to a collection")}d=f.cid;k=f.id;if(i[d]||this._byCid[d]||((k!=null)&&(b[k]||this._byId[k]))){h.push(g);continue}i[d]=b[k]=f}g=h.length;while(g--){a.splice(h[g],1)}for(g=0,j=a.length;g<j;g++){(f=a[g]).on("all",this._onModelEvent,this);this._byCid[f.cid]=f;if(f.id!=null){this._byId[f.id]=f}}this.length+=j;e=c.at!=null?c.at:this.models.length;D.apply(this.models,[e,0].concat(a));if(this.comparator){this.sort({silent:true})}if(c.silent){return this}for(g=0,j=this.models.length;g<j;g++){if(!i[(f=this.models[g]).cid]){continue}c.index=g;f.trigger("add",f,this,c)}return this},remove:function(a,c){var b,f,d,e;c||(c={});a=N.isArray(a)?a.slice():[a];for(b=0,f=a.length;b<f;b++){e=this.getByCid(a[b])||this.get(a[b]);if(!e){continue}delete this._byId[e.id];delete this._byCid[e.cid];d=this.indexOf(e);this.models.splice(d,1);this.length--;if(!c.silent){c.index=d;e.trigger("remove",e,this,c)}this._removeReference(e)}return this},push:function(a,b){a=this._prepareModel(a,b);this.add(a,b);return a},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){a=this._prepareModel(a,b);this.add(a,N.extend({at:0},b));return a},shift:function(a){var b=this.at(0);this.remove(b,a);return b},get:function(a){if(a==null){return void 0}return this._byId[a.id!=null?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},where:function(a){if(N.isEmpty(a)){return[]}return this.filter(function(c){for(var b in a){if(a[b]!==c.get(b)){return false}}return true})},sort:function(a){a||(a={});if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}var b=N.bind(this.comparator,this);if(this.comparator.length==1){this.models=this.sortBy(b)}else{this.models.sort(b)}if(!a.silent){this.trigger("reset",this,a)}return this},pluck:function(a){return N.map(this.models,function(b){return b.get(a)})},reset:function(a,c){a||(a=[]);c||(c={});for(var b=0,d=this.models.length;b<d;b++){this._removeReference(this.models[b])}this._reset();this.add(a,N.extend({silent:true},c));if(!c.silent){this.trigger("reset",this,c)}return this},fetch:function(c){c=c?N.clone(c):{};if(c.parse===undefined){c.parse=true}var a=this;var b=c.success;c.success=function(d,f,e){a[c.add?"add":"reset"](a.parse(d,e),c);if(b){b(a,d)}};c.error=ab.wrapError(c.error,a,c);return(this.sync||ab.sync).call(this,"read",this,c)},create:function(c,d){var b=this;d=d?N.clone(d):{};c=this._prepareModel(c,d);if(!c){return false}if(!d.wait){b.add(c,d)}var a=d.success;d.success=function(g,e,f){if(d.wait){b.add(g,d)}if(a){a(g,e)}else{g.trigger("sync",c,e,d)}};c.save(null,d);return c},parse:function(a,b){return a},chain:function(){return N(this.models).chain()},_reset:function(a){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(a,b){b||(b={});if(!(a instanceof T)){var c=a;b.collection=this;a=new this.model(c,b);if(!a._validate(a.attributes,b)){a=false}}else{if(!a.collection){a.collection=this}}return a},_removeReference:function(a){if(this==a.collection){delete a.collection}a.off("all",this._onModelEvent,this)},_onModelEvent:function(b,c,a,d){if((b=="add"||b=="remove")&&a!=this){return}if(b=="destroy"){this.remove(c,d)}if(c&&b==="change:"+c.idAttribute){delete this._byId[c.previous(c.idAttribute)];this._byId[c.id]=c}this.trigger.apply(this,arguments)}});var F=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];N.each(F,function(a){L.prototype[a]=function(){return N[a].apply(N,[this.models].concat(N.toArray(arguments)))}});var C=ab.Router=function(a){a||(a={});if(a.routes){this.routes=a.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var V=/:\w+/g;var E=/\*\w+/g;var Z=/[-[\]{}()+?.,\\^$|#\s]/g;N.extend(C.prototype,Q,{initialize:function(){},route:function(c,b,a){ab.history||(ab.history=new ac);if(!N.isRegExp(c)){c=this._routeToRegExp(c)}if(!a){a=this[b]}ab.history.route(c,N.bind(function(d){var e=this._extractParameters(c,d);a&&a.apply(this,e);this.trigger.apply(this,["route:"+b].concat(e));ab.history.trigger("route",this,b,e)},this));return this},navigate:function(a,b){ab.history.navigate(a,b)},_bindRoutes:function(){if(!this.routes){return}var c=[];for(var b in this.routes){c.unshift([b,this.routes[b]])}for(var a=0,d=c.length;a<d;a++){this.route(c[a][0],c[a][1],this[c[a][1]])}},_routeToRegExp:function(a){a=a.replace(Z,"\\$&").replace(V,"([^/]+)").replace(E,"(.*?)");return new RegExp("^"+a+"$")},_extractParameters:function(b,a){return b.exec(a).slice(1)}});var ac=ab.History=function(){this.handlers=[];N.bindAll(this,"checkUrl")};var R=/^[#\/]/;var U=/msie [\w.]+/;ac.started=false;N.extend(ac.prototype,Q,{interval:50,getHash:function(a){var b=a?a.location:window.location;var c=b.href.match(/#(.*)$/);return c?c[1]:""},getFragment:function(b,c){if(b==null){if(this._hasPushState||c){b=window.location.pathname;var a=window.location.search;if(a){b+=a}}else{b=this.getHash()}}if(!b.indexOf(this.options.root)){b=b.substr(this.options.root.length)}return b.replace(R,"")},start:function(d){if(ac.started){throw new Error("Backbone.history has already been started")}ac.started=true;this.options=N.extend({},{root:"/"},this.options,d);this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var e=this.getFragment();var f=document.documentMode;var b=(U.exec(navigator.userAgent.toLowerCase())&&(!f||f<=7));if(b){this.iframe=X('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(e)}if(this._hasPushState){X(window).on("popstate",this.checkUrl)}else{if(this._wantsHashChange&&("onhashchange" in window)&&!b){X(window).on("hashchange",this.checkUrl)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}this.fragment=e;var a=window.location;var c=a.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!c){this.fragment=this.getFragment(null,true);window.location.replace(this.options.root+"#"+this.fragment);return true}else{if(this._wantsPushState&&this._hasPushState&&c&&a.hash){this.fragment=this.getHash().replace(R,"");window.history.replaceState({},document.title,a.protocol+"//"+a.host+this.options.root+this.fragment)}}if(!this.options.silent){return this.loadUrl()}},stop:function(){X(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);ac.started=false},route:function(b,a){this.handlers.unshift({route:b,callback:a})},checkUrl:function(a){var b=this.getFragment();if(b==this.fragment&&this.iframe){b=this.getFragment(this.getHash(this.iframe))}if(b==this.fragment){return false}if(this.iframe){this.navigate(b)}this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var b=this.fragment=this.getFragment(a);var c=N.any(this.handlers,function(d){if(d.route.test(b)){d.callback(b);return true}});return c},navigate:function(b,c){if(!ac.started){return false}if(!c||c===true){c={trigger:c}}var a=(b||"").replace(R,"");if(this.fragment==a){return}if(this._hasPushState){if(a.indexOf(this.options.root)!=0){a=this.options.root+a}this.fragment=a;window.history[c.replace?"replaceState":"pushState"]({},document.title,a)}else{if(this._wantsHashChange){this.fragment=a;this._updateHash(window.location,a,c.replace);if(this.iframe&&(a!=this.getFragment(this.getHash(this.iframe)))){if(!c.replace){this.iframe.document.open().close()}this._updateHash(this.iframe.location,a,c.replace)}}else{window.location.assign(this.options.root+b)}}if(c.trigger){this.loadUrl(b)}},_updateHash:function(c,b,a){if(a){c.replace(c.toString().replace(/(javascript:|#).*$/,"")+"#"+b)}else{c.hash=b}}});var J=ab.View=function(a){this.cid=N.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var Y=/^(\S+)\s*(.*)$/;var H=["model","collection","el","id","attributes","className","tagName"];N.extend(J.prototype,Q,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();return this},make:function(c,d,a){var b=document.createElement(c);if(d){X(b).attr(d)}if(a){X(b).html(a)}return b},setElement:function(b,a){if(this.$el){this.undelegateEvents()}this.$el=(b instanceof X)?b:X(b);this.el=this.$el[0];if(a!==false){this.delegateEvents()}return this},delegateEvents:function(b){if(!(b||(b=aa(this,"events")))){return}this.undelegateEvents();for(var c in b){var a=b[c];if(!N.isFunction(a)){a=this[b[c]]}if(!a){throw new Error('Method "'+b[c]+'" does not exist')}var d=c.match(Y);var e=d[1],f=d[2];a=N.bind(a,this);e+=".delegateEvents"+this.cid;if(f===""){this.$el.bind(e,a)}else{this.$el.delegate(f,e,a)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(b){if(this.options){b=N.extend({},this.options,b)}for(var a=0,c=H.length;a<c;a++){var d=H[a];if(b[d]){this[d]=b[d]}}this.options=b},_ensureElement:function(){if(!this.el){var a=aa(this,"attributes")||{};if(this.id){a.id=this.id}if(this.className){a["class"]=this.className}this.setElement(this.make(this.tagName,a),false)}else{this.setElement(this.el,false)}}});var G=function(c,b){var a=S(this,c,b);a.extend=this.extend;return a};T.extend=L.extend=C.extend=J.extend=G;var K={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};ab.sync=function(a,d,e){var c=K[a];e||(e={});var b={type:c,dataType:"json"};if(!e.url){b.url=aa(d,"url")||I()}if(!e.data&&d&&(a=="create"||a=="update")){b.contentType="application/json";b.data=JSON.stringify(d.toJSON())}if(ab.emulateJSON){b.contentType="application/x-www-form-urlencoded";b.data=b.data?{model:b.data}:{}}if(ab.emulateHTTP){if(c==="PUT"||c==="DELETE"){if(ab.emulateJSON){b.data._method=c}b.type="POST";b.beforeSend=function(f){f.setRequestHeader("X-HTTP-Method-Override",c)}}}if(b.type!=="GET"&&!ab.emulateJSON){b.processData=false}return X.ajax(N.extend(b,e))};ab.wrapError=function(b,a,c){return function(e,d){d=e===a?d:e;if(b){b(a,d,c)}else{a.trigger("error",a,d,c)}}};var W=function(){};var S=function(c,d,b){var a;if(d&&d.hasOwnProperty("constructor")){a=d.constructor}else{a=function(){c.apply(this,arguments)}}N.extend(a,c);W.prototype=c.prototype;a.prototype=new W();if(d){N.extend(a.prototype,d)}if(b){N.extend(a,b)}a.prototype.constructor=a;a.__super__=c.prototype;return a};var aa=function(b,a){if(!(b&&b[a])){return null}return N.isFunction(b[a])?b[a]():b[a]};var I=function(){throw new Error('A "url" property or function must be specified')}}).call(this);