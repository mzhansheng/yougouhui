define(["jquery","backbone","views/BackModelView","utils"],function(m,j,l,n){var i=null;var h=null;var k=l.extend({constructor:function(a){k.__super__.constructor.call(this,a)},initialize:function(){k.__super__.initialize.call(this);i=this},render:function(){k.__super__.render.call(this);var a="main-head-share-save-link";var c=m("#"+a);if(c&&c.length>0){c.css("display","block")}else{var d='<a id="'+a+'" class="top-header ui-btn ui-btn-inline ui-corner-all ui-icon-lock ui-btn-icon-left">保存</a>';m("#main-head-search-link").after(d)}n.setDomVisibleExcept(m('[data-role="header"].app-header div a'),[a]);m("#share-choose-pic-img").on("click",function(){n.openPopDiv("#share-choose-pic-pop",m(this))});m("#li-share-camera-pic").on("click",function(){n.closePopDiv("#share-choose-pic-pop");navigator.camera.getPicture(i.onPicChooseSuccess,i.onFail,{quality:20,allowEdit:true,sourceType:Camera.PictureSourceType.CAMERA,destinationType:Camera.DestinationType.FILE_URI})});m("#li-share-choose-pic").on("click",function(){n.closePopDiv("#share-choose-pic-pop");navigator.camera.getPicture(i.onPicChooseSuccess,i.onFail,{quality:20,allowEdit:true,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,destinationType:Camera.DestinationType.FILE_URI})});try{}catch(b){}return this},onPicChooseSuccess:function(a){var f=m("#share-choose-pic-div");var c=a;var b=c.lastIndexOf(".");if(b>0){c=c.substring(0,b)}b=c.lastIndexOf("/");if(b>0){c=c.substring(b+1,c.length)}var e="share-img-"+c;var d='<div class="share-choose-pic" style="max-width:20%"><a href="#" data-rel="popup" id="'+e+'" data-position-to="window" data-transition="fade" class="share-popup-img">  <img src="'+a+'" height="150px" style="margin:5px;max-width:100%"/>  </a> </div>';f.before(d);m("#"+e).on("click",function(){var g=m(this).find("img").attr("src");var q="share-pop-img-id-"+c;if(m("#"+q).length===0){var r=' <div data-role="popup" id="'+q+'" data-overlay-theme="b" data-theme="b" data-corners="false">  <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">关闭</a>  <img src="'+g+'" width="'+m.mobile.activePage.width()+'" height="'+m.mobile.activePage.height()+'"/>  </div>';m.mobile.activePage.append(r).trigger("create")}n.openPopDiv("#"+q,m(this))})},onFail:function(a){alert("获取照片失败，原因："+a)},onGeolocationSuccess:function(a){h=a},ongeolocationError:function(a){alert("获取地理位置出错，原因："+a.message)}});return k});