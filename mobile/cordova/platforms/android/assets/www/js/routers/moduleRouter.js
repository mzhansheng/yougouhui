define(["jquery","backbone","collections/ModuleCollection","views/ModuleView","config","utils"],function(d,g,b,e,a,c){var f=g.Router.extend({initialize:function(){this.discoverView=new e({el:"#discover",collection:new b([],{type:"discover"})});g.history.start();this.meView=new e({el:"#me",collection:new b([],{type:"me"})})},routes:{"module?:type":"module"},module:function(h){var i=this[h+"View"];d("#main-back-link").css("display","none");d("#main-head-title").html(a.getAppTitle());c.setDomVisibleExcept(d('[data-role="header"].app-header div a'),["main-head-city-link","main-head-search-link"]);if(i&&!i.collection.length){d.mobile.loading("show");i.collection.fetch({success:function(l,j,k){l.trigger("added")},error:function(){d.mobile.loading("hide");alert("加载数据失败.")}}).done(function(){d.mobile.loading("hide");d.mobile.changePage("#"+h,{reverse:false,changeHash:false})})}else{d.mobile.changePage("#"+h,{reverse:false,changeHash:false})}}});return f});