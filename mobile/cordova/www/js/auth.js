define(["db","jquery","config"],function(c,d,a){var b="CREATE TABLE IF NOT EXISTS e_user (phone integer primary key, pwd text)";c.executeSql(b);return{login:function(e){var g=false;var f=" select pwd from e_user where phone = ?";c.executeSql(f,[e.phone],function(h,i){if(i&&i.rows&&i.rows.length===1){if(i.rows.item(0).pwd==e.pwd){g=true}}},function(h){});if(!g){d.ajax({type:"POST",async:false,dataType:"json",url:a.getBaseUrl()+"/login",data:e,success:function(h){g=h.authed;if(!g){var i=h["error-type"];if(i==="user-error"){alert("手机号错误.")}else{alert("密码错误.")}}else{c.executeSql("select pwd from e_user where phone = ? ",[e.phone],function(j,k){if(k&&k.rows&&k.rows.length===1){c.executeSql(" update e_user set pwd = ? where phone = ?",[e.pwd,e.phone])}else{c.executeSql(" insert into e_user(pwd, phone) values(?, ?)",[e.pwd,e.phone])}},function(j){console.log("ERROR: "+j.message)})}},error:function(h,j,i){alert("无法连接服务器.")}})}if(g){c.executeSql("select data from e_env",[],function(h,i){if(i&&i.rows&&i.rows.length===1){c.executeSql(" update e_env set data = ? where id = 1",[e])}else{c.executeSql(" insert into e_env(id, data) values(?, ?)",[1,e])}},function(h){console.log("ERROR: "+h.message)})}return g}}});